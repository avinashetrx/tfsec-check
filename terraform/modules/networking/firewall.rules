# Bastion
pass http ${BASTION_CIDR}    [1024:]  -> any                   80      (http.host; content:"example.com"; startswith; endswith; msg:"Allow HTTP traffic to example.com"; flow:to_server; sid:1; rev:1;)
pass tls  ${BASTION_CIDR}    [1024:]  -> any                   443     (tls.sni; content:"http.cat"; startswith; nocase; endswith; msg:"Allow TLS (HTTPS) traffic to http.cat"; flow:to_server; sid:2; rev:1;)

# Jaspersoft
pass tls  ${JASPERSOFT_CIDR} [1024:]  -> any                   443     (tls.sni; content:".ubuntu.com"; nocase; endswith; msg:"Allow TLS (HTTPS) traffic to *.ubuntu.com"; flow:to_server; sid:101; rev:1;)
pass http ${JASPERSOFT_CIDR} [1024:]  -> any                   80      (http.host; content:".ubuntu.com"; endswith; msg:"Allow HTTP traffic to *.ubuntu.com"; flow:to_server; sid:102; rev:1;)
pass tls  ${JASPERSOFT_CIDR} [1024:]  -> any                   443     (tls.sni; content:".launchpad.net"; nocase; endswith; msg:"Allow TLS (HTTPS) traffic to *.launchpad.net"; flow:to_server; sid:103; rev:1;)
pass http ${JASPERSOFT_CIDR} [1024:]  -> any                   80      (http.host; content:".ubuntu.com"; endswith; msg:"Allow HTTP traffic to *.launchpad.net"; flow:to_server; sid:104; rev:1;)
pass tls  ${JASPERSOFT_CIDR} [1024:]  -> any                   443     (tls.sni; content:"archive.apache.org"; startswith; nocase; endswith; msg:"Allow TLS (HTTPS) traffic to archive.apache.org"; flow:to_server; sid:105; rev:1;)
pass tls  ${JASPERSOFT_CIDR} [1024:]  -> any                   443     (tls.sni; content:".postgresql.org"; nocase; endswith; msg:"Allow TLS (HTTPS) traffic to *.postgresql.org"; flow:to_server; sid:106; rev:1;)
pass http ${JASPERSOFT_CIDR} [1024:]  -> any                   80      (http.host; content:".postgresql.org"; endswith; msg:"Allow HTTP traffic to *.postgresql.org"; flow:to_server; sid:107; rev:1;)


# The drop http and tls seem to kick in earlier than only dropping established TCP flows
drop http any                   any      -> any                   any     (msg:"Drop other HTTP traffic"; sid:1001; rev:1;)
drop tls  any                   any      -> any                   any     (msg:"not matching any TLS allowlisted FQDNs"; sid:1002; rev:1;)
drop tcp  any                   any      -> any                   any     (msg:"Drop remaining estabilshed TCP traffic"; flow:established; sid:1003; rev:1;)
# Non-TCP traffic should already have been dropped by the stateless rules, but just to be sure
drop ip   any                   any      <> any                   any     (msg: "Drop non-TCP traffic"; ip_proto:!TCP;sid:1004; rev:1;)
